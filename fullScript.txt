CREATE DATABASE first_lab;
USE first_lab;
CREATE TABLE teachers (
   personal_number VARCHAR(4),
   lastname VARCHAR(50),
   position VARCHAR(50),
   department VARCHAR(50),
   specialty VARCHAR(50),
   home_phone INT(3)
) CHARACTER SET utf8
  COLLATE utf8_unicode_CI;
INSERT INTO teachers (personal_number, lastname, position, department, specialty, home_phone)
VALUES ('221Л', 'Фролов', 'Доцент', 'ЭВМ', 'АСОИ, ЭВМ', 487),
       ('222Л',	'Костин', 'Доцент',	'ЭВМ', 'ЭВМ', 543),
	   ('225Л',	'Бойко', 'Профессор', 'АСУ', 'АСОИ, ЭВМ', 112),
       ('430Л',	'Глазов', 'Ассистент', 'ТФ', 'СД', 421),
       ('110Л',	'Петров', 'Ассистент', 'Экономики', 'Международная экономика', 324);
CREATE TABLE lessons (
   lesson_number VARCHAR(4),
   lesson_name VARCHAR(50),
   hours VARCHAR(50),
   specialty VARCHAR(50),
   term INT(3)
) CHARACTER SET utf8
  COLLATE utf8_unicode_CI;
INSERT INTO lessons (lesson_number, lesson_name, hours, specialty, term)
VALUES ('12П', 'Мини ЭВМ', 36, 'ЭВМ', 1),
       ('14П', 'ПЭВМ', 72, 'ЭВМ', 2),
	   ('17П', 'СУБД ПК', 48, 'АСОИ', 4),
       ('18П', 'ВКСС', 52, 'АСОИ', 6),
       ('34П', 'Физика', 30, 'СД', 6),
       ('22П', 'Аудит', 24,	'Бухучета', 3);
CREATE TABLE student_groups (
 group_number VARCHAR(5),
 group_name VARCHAR(50),
 persons_numer INT(5),
 specialty VARCHAR(50),
 headman_lastname VARCHAR(50)
 ) CHARACTER SET utf8
  COLLATE utf8_unicode_CI;
INSERT INTO student_groups (group_number, group_name, persons_number, specialty, headman_lastname)
VALUES ('8Г', 'Э-12', 18, 'ЭВМ', 'Иванова'),
       ('7Г', 'Э-15', 22, 'ЭВМ', 'Сеткин'),
       ('4Г', 'АС-9', 24, 'АСОИ', 'Балабанов'),
       ('3Г', 'АС-8', 20, 'АСОИ', 'Чижов'),
       ('17Г', 'С-14', 29, 'СД', 'Амросов'),
       ('12Г', 'М-6', 16, 'Международная экономика', 'Трубин'),
       ('10Г', 'Б-4', 21, 'Бухучет', 'Зязюткин');
CREATE TABLE classroom_numbers (
 group_number VARCHAR(5),
 lesson_number VARCHAR(5),
 personal_number VARCHAR(5),
 classroom_number INT(5)
 ) CHARACTER SET utf8
  COLLATE utf8_unicode_CI;
INSERT INTO classroom_numbers (group_number, lesson_number, personal_number, classroom_number)
VALUES ('8Г', '12П', '222Л', 112),
	   ('8Г', '14П', '221Л', 220),
       ('8Г', '17П', '222Л', 112),
       ('7Г', '14П', '221Л', 220),
       ('7Г', '17П', '222Л', 241),
       ('7Г', '18П', '225Л', 210),
       ('4Г', '12П', '222Л', 112),
	   ('4Г', '18П', '225Л', 210),
       ('3Г', '12П', '222Л', 112),
       ('3Г', '17П', '221Л', 241),
       ('3Г', '18П', '225Л', 210),
	   ('17Г', '12П', '222Л', 112),
       ('17Г', '22П', '110Л', 220),
       ('17Г', '34П', '430Л', 118),
       ('12Г', '12П', '222Л', 112),
	   ('12Г', '22П', '110Л', 210),
       ('10Г', '12П', '222Л', 210),
       ('10Г', '22П', '110Л', 210);
	   
SELECT *
FROM teachers;

SELECT *
FROM student_groups WHERE specialty = 'ЭВМ';

SELECT personal_number, classroom_number
FROM classroom_numbers WHERE lesson_number = '18П';

SELECT DISTINCT lessons.lesson_number, lessons.lesson_name 
FROM lessons 
JOIN classroom_numbers ON classroom_numbers.lesson_number = lessons.lesson_number 
JOIN teachers ON classroom_numbers.personal_number = teachers.personal_number
WHERE teachers.lastname = 'Костин';

SELECT DISTINCT student_groups.group_number 
FROM student_groups
JOIN classroom_numbers ON classroom_numbers.group_number = student_groups.group_number
JOIN teachers ON classroom_numbers.personal_number = teachers.personal_number
WHERE teachers.lastname = 'Фролов';

SELECT * 
FROM lessons WHERE specialty = 'АСОИ';

SELECT *
FROM teachers WHERE specialty REGEXP 'АСОИ';

SELECT DISTINCT teachers.lastname 
FROM teachers
JOIN classroom_numbers ON classroom_numbers.personal_number = teachers.personal_number
WHERE classroom_numbers.classroom_number = 210;

SELECT lessons.lesson_name, student_groups.group_name
FROM classroom_numbers
JOIN lessons ON lessons.lesson_number = classroom_numbers.lesson_number
JOIN student_groups ON student_groups.group_number = classroom_numbers.group_number
WHERE classroom_number 
BETWEEN 100 AND 200;

SELECT DISTINCT s1.group_number, s2.group_number
FROM student_groups s1, student_groups s2
WHERE s1.specialty = s2.specialty AND s1.group_number <> s2.group_number;  

SELECT SUM(persons_number)
FROM student_groups WHERE specialty = 'ЭВМ';

SELECT DISTINCT teachers.personal_number
FROM teachers
JOIN classroom_numbers ON classroom_numbers.personal_number = teachers.personal_number
JOIN student_groups ON student_groups.group_number = classroom_numbers.group_number
WHERE student_groups.specialty = 'ЭВМ';

13?

14?

SELECT DISTINCT *
FROM lessons
JOIN classroom_numbers ON classroom_numbers.lesson_number = lessons.lesson_number
WHERE classroom_numbers.personal_number <> '221П';

SELECT DISTINCT *
FROM lessons
WHERE lessons.lesson_number NOT IN (
SELECT distinct classroom_numbers.lesson_number
FROM classroom_numbers
JOIN student_groups ON student_groups.group_number = classroom_numbers.group_number
WHERE student_groups.group_name = 'М-6');

SELECT DISTINCT *
FROM teachers 
WHERE teachers.position = 'Доцент' AND teachers.personal_number IN (
SELECT DISTINCT classroom_numbers.personal_number 
FROM classroom_numbers
WHERE classroom_numbers.group_number IN ('8Г', '3Г')
);

SELECT DISTINCT classroom_numbers.lesson_number,
                classroom_numbers.personal_number,
				classroom_numbers.group_number
FROM classroom_numbers
JOIN teachers ON teachers.personal_number = classroom_numbers.personal_number
WHERE teachers.department = 'ЭВМ' AND teachers.specialty REGEXP 'АСОИ';

SELECT DISTINCT student_groups.group_number
FROM student_groups
JOIN classroom_numbers ON classroom_numbers.group_number = student_groups.group_number
JOIN teachers ON teachers.personal_number = classroom_numbers.personal_number
WHERE student_groups.specialty = teachers.specialty;

SELECT DISTINCT teachers.personal_number
FROM teachers
JOIN classroom_numbers ON classroom_numbers.personal_number = teachers.personal_number
JOIN lessons ON lessons.lesson_number = classroom_numbers.lesson_number
WHERE teachers.specialty = 'ЭВМ' AND lessons.specialty IN (
SELECT DISTINCT student_groups.specialty
FROM student_groups);

SELECT DISTINCT student_groups.specialty
FROM student_groups
JOIN classroom_numbers ON classroom_numbers.group_number = student_groups.group_number
JOIN teachers ON teachers.personal_number = classroom_numbers.personal_number
WHERE teachers.department = 'АСУ' AND teachers.specialty REGEXP student_groups.specialty;

SELECT DISTINCT lessons.lesson_number
FROM lessons
JOIN classroom_numbers ON classroom_numbers.lesson_number = lessons.lesson_number
JOIN student_groups ON student_groups.group_number = classroom_numbers.group_number
WHERE student_groups.group_name = 'АС-8';

SELECT DISTINCT student_groups.group_number
FROM student_groups
JOIN classroom_numbers ON classroom_numbers.group_number = student_groups.group_number
WHERE classroom_numbers.lesson_number IN (
SELECT classroom_numbers.lesson_number
FROM classroom_numbers
JOIN student_groups ON student_groups.group_number = classroom_numbers.group_number
WHERE student_groups.group_name = 'АС-8');

SELECT DISTINCT student_groups.group_number
FROM student_groups
JOIN classroom_numbers ON classroom_numbers.group_number = student_groups.group_number
WHERE classroom_numbers.lesson_number NOT IN (
SELECT classroom_numbers.lesson_number
FROM classroom_numbers
JOIN student_groups ON student_groups.group_number = classroom_numbers.group_number
WHERE student_groups.group_name = 'АС-8');

SELECT DISTINCT group_number
FROM classroom_numbers
WHERE lesson_number NOT IN (
SELECT lesson_number
FROM classroom_numbers
WHERE personal_number = '430Л');

SELECT DISTINCT personal_number
FROM classroom_numbers
JOIN student_groups ON student_groups.group_number = classroom_numbers.group_number
WHERE student_groups.group_name = 'Э-15' AND lesson_number NOT IN (
SELECT lesson_number
FROM classroom_numbers
WHERE lesson_number = '12П');
